<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Markdown Template</title>
    <link rel="stylesheet" href="css/markdown.css" />
    <link rel="stylesheet" href="css/code.css" />
    <link rel="stylesheet" href="https://use.sevencdn.com/ajax/libs/KaTeX/0.16.9/katex.min.css" />
    <style>
        :root {
            --border-radius: 12px;
            /* 稍微增加圆角大小使效果更明显 */
            --shadow-color: rgba(0, 0, 0, 0.1);
            --accent-color: #b981d1;
            /* 移除不需要的变量 */
            /* --qr-padding: 0; */
        }

        body {
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
            position: relative;
        }

        .background-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 0;
        }

        .content-box {
            position: relative;
            z-index: 1;
            margin: 20px;
            width: calc(100% - 40px);
            flex: 1;
            border-radius: var(--border-radius);
            background-color: rgba(255, 255, 255, 0.8);
            overflow: visible;
        }


        .main-content {
            padding: 20px;
        }

        .footer-content {
            position: relative;
            display: flex;
            justify-content: center;
            /* 居中显示作者信息 */
            padding: 10px 20px 20px;
            border-top: 1px solid var(--shadow-color);
            min-height: 80px;
        }

        #markdown {
            padding: var(--spacing);
            border-radius: 5px;
        }

        #qr_code {
            position: absolute;
            right: 10px;
            bottom: 10px;
            width: 100px;
            height: 100px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px var(--shadow-color);
            z-index: 10;
        }

        #qr_code img {
            width: 90px;
            height: 90px;
            margin: 5px;
            display: block;
            box-shadow: none;
        }

        #author {
            text-align: center;
            margin: 0;
            /* 移除右侧padding */
        }

        #author span {
            color: var(--accent-color);
        }
    </style>
</head>

<body>
    <div class="background-layer"></div>
    <div class="content-box">

        <div class="main-content">
            <div id="markdown">${content}</div>
        </div>
        <div class="footer-content">
            <div id="author">
                <p>
                    Generated by
                    <span>chatluna</span>
                    &
                    <span>koishi</span>
                </p>
            </div>
        </div>

        <div id="qr_code">
            <img src="${qr_data}" alt="qr_code" />
        </div>

    </div>
    <script type="module">
        import mermaid from 'https://use.sevencdn.com/ajax/libs/mermaid/11.4.1/mermaid.esm.min.mjs';
    </script>
    <script>
        // 设置背景和模糊效果
        const backgroundLayer = document.querySelector('.background-layer');
        const contentBox = document.querySelector('.content-box');
        const backgroundImage = "${background}";
        const blurAmount = "${blurAmount}";
        const backgroundMaskOpacity = "${backgroundMaskOpacity}";

        if (backgroundImage.length > 0) {
            backgroundLayer.style.backgroundImage = 'url(' + backgroundImage + ')';
            backgroundLayer.style.backgroundSize = 'cover';
            backgroundLayer.style.backgroundPosition = 'center';

            // 创建模糊层
            const blurLayer = document.createElement('div');
            blurLayer.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                backdrop-filter: blur(${blurAmount}px);
                -webkit-backdrop-filter: blur(${blurAmount}px);
            `;

            backgroundLayer.appendChild(blurLayer);


        }

        if (blurAmount.length > 0) {
            backgroundLayer.style.backdropFilter = 'blur(' + blurAmount + 'px)';
            backgroundLayer.style.webkitBackdropFilter = 'blur(' + blurAmount + 'px)';
        }

        if (backgroundMaskOpacity.length > 0) {
            contentBox.style.backgroundColor = 'rgba(255, 255, 255, ' + backgroundMaskOpacity + ')';

        }

        // 处理二维码显示和作者布局
        const qrCode = document.getElementById('qr_code');
        const qrCodeData = "${qr_data}";

        if (qrCodeData.length > 0) {
            qrCode.style.display = 'block';
        } else {
            qrCode.style.display = 'none';
        }
    </script>
</body>


</html>
